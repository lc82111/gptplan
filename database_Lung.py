import sqlite3
import pandas as pd
import textwrap
import numpy as np

class LungCancerDB:
    def __init__(self, db_name='.lung_cancer.db'):
        self.conn = sqlite3.connect(db_name)
        self.cursor = self.conn.cursor()
        self.create_tables()
        self.build_db()

    def build_db(self):
        # Add lung patients' volumes and ptv distances to the database
        # ptv, esophagus, heart, cord, lung_l, lung_r, cord, esophagus_ptv_distance, heart_ptv_distance, lung_l_ptv_distance, lung_r_ptv_distance, cord_ptv_distance
        self.add_patient("Lung_Patient_18", 147.53, 53.78, 1155.63, 1858.57, 2431.17, 74.34, 99.39, 110.34, 164.50, 47.03, 115.86)
        self.add_patient("Lung_Patient_23", 65.26, 46.45, 1057.55, 2138.70, 2535.62, 42.78, 108.71, 79.93, 42.45, 178.94, 137.12)
        self.add_patient("Lung_Patient_30", 112.21, 36.13, 728.07, 1146.06, 1908.83, 42.73, 66.13, 116.89, 106.06, 55.84, 34.90)
        self.add_patient("Lung_Patient_33", 58.64, 34.95, 603.83, 2641.09, 2411.55, 69.03, 100.00, 112.00, 170.96, 43.68, 132.97)
        self.add_patient("Lung_Patient_34", 81.25, 35.98, 764.38, 3076.26, 3261.38, 51.53, 125.25, 91.57, 50.63, 189.27, 161.50)
        self.add_patient("Lung_Patient_36", 45.07, 41.73, 504.39, 2572.99, 2836.14, 72.64, 107.28, 76.83, 63.36, 180.24, 148.00)
        self.add_patient("Lung_Patient_37", 91.20, 39.32, 653.01, 2532.07, 2405.19, 63.61, 88.13, 106.42, 30.65, 162.43, 107.95)
        self.add_patient("Lung_Patient_42", 59.39, 36.56, 612.27, 2209.26, 3126.88, 84.76, 87.95, 84.08, 136.18, 70.81, 126.79)
        self.add_patient("Lung_Patient_44", 99.59, 27.87, 874.72, 1614.82, 1988.38, 46.87, 63.90, 125.76, 116.91, 64.68, 34.37)
        self.add_patient("Lung_Patient_45", 55.45, 38.86, 968.51, 1953.23, 1472.28, 44.46, 95.45, 106.34, 17.81, 164.19, 101.25)
        self.add_patient("Lung_Patient_46", 59.14, 31.70, 877.54, 3261.96, 3588.27, 44.43, 127.56, 150.02, 189.15, 57.82, 114.84)
        self.add_patient("Lung_Patient_48", 103.01, 38.12, 740.76, 2693.28, 3274.80, 59.12, 87.20, 126.53, 46.66, 167.16, 83.49)
        # self.add_patient("Lung_Patient_6", 87.49, 56.72, 678.15, 1617.27, 2155.67, 70.87, 84.29, 102.60, 160.07, 45.59, 123.37)
        # self.add_patient("Lung_Patient_7", 177.27, 50.55, 617.17, 1335.51, 1288.47, 77.92, 56.80, 113.06, 129.21, 34.17, 55.10)

        # Add best iteration data to the database
        # name, opt_para, dose_outcomes
        self.add_best_iteration("Lung_Patient_18",
        'OptPara:\n| ROI Name      | Objective Type       | Target Gy            | % Volume   | Weight   |\n|:--------------|:---------------------|:---------------------|:-----------|:---------|\n| PTV           | quadratic-overdose   | 55                   | NA         | 35000    |\n| PTV           | quadratic-underdose  | 61.5                 | NA         | 1900000  |\n| PTV           | max_dose             | 66                   | NA         | NA       |\n| PTV           | linear-overdose      | 62.5                 | NA         | 27000    |\n| GTV           | max_dose             | 69                   | NA         | NA       |\n| CORD          | linear-overdose      | 12                   | NA         | 15000    |\n| CORD          | quadratic            | NA                   | NA         | 140      |\n| CORD          | max_dose             | 38                   | NA         | NA       |\n| ESOPHAGUS     | quadratic            | NA                   | NA         | 100      |\n| ESOPHAGUS     | max_dose             | 11                   | NA         | NA       |\n| ESOPHAGUS     | mean_dose            | 10                   | NA         | NA       |\n| HEART         | quadratic            | NA                   | NA         | 40       |\n| HEART         | max_dose             | 30                   | NA         | NA       |\n| HEART         | mean_dose            | 15                   | NA         | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA                   | NA         | 220      |\n| LUNGS_NOT_GTV | max_dose             | 63                   | NA         | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 18                   | 25         | NA       |\n| LUNG_L        | quadratic            | NA                   | NA         | 60       |\n| LUNG_L        | max_dose             | 64                   | NA         | NA       |\n| LUNG_R        | quadratic            | NA                   | NA         | 60       |\n| LUNG_R        | max_dose             | 64                   | NA         | NA       |\n| RIND_0        | quadratic            | NA                   | NA         | 20       |\n| RIND_0        | max_dose             | 63                   | NA         | NA       |\n| RIND_1        | quadratic            | NA                   | NA         | 15       |\n| RIND_1        | max_dose             | 62                   | NA         | NA       |\n| RIND_2        | quadratic            | NA                   | NA         | 15       |\n| RIND_2        | max_dose             | 52                   | NA         | NA       |\n| RIND_3        | quadratic            | NA                   | NA         | 15       |\n| RIND_3        | max_dose             | 50                   | NA         | NA       |\n| RIND_4        | quadratic            | NA                   | NA         | 15       |\n| RIND_4        | max_dose             | 45                   | NA         | NA       |\n| SKIN          | max_dose             | 60                   | NA         | NA       |\n| NA            | smoothness-quadratic | NA                   | NA         | 200      |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.19 |        64.53 | Meets Limit                                      |          2 |\n| max_dose     | PTV              |    69   |  64.64 |        64.53 | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        61.24 | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  15.45 |        13.17 | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   4.53 |         4.66 | Meets Limit                                      |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   8.59 |         9.17 | Meets Limit                                      |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  14.66 |        13.65 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   2.65 |        11    | Meets Limit                                      |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.37 |         1.69 | Meets Limit                                      |          5 |\n| max_dose     | RIND_0           |    66   |  62.84 |        63    | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  58.34 |        62    | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        52    | Meets Both Goal and Limit                        |          7 |\n| max_dose     | RIND_3           |    51   |  49.2  |        50    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.91 |         0.8  | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.09 |         0.03 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_23",
        'OptPara:\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|---------------|----------------------|-----------|----------|----------|\n| PTV           | quadratic-overdose   | 61        | NA       | 18000    |\n| PTV           | quadratic-underdose  | 60.5      | NA       | 280000   |\n| PTV           | dose_volume_V        | 60.0      | 98       | NA       |\n| GTV           | max_dose             | 69        | NA       | NA       |\n| CORD          | linear-overdose      | 34        | NA       | 27000    |\n| CORD          | quadratic            | NA        | NA       | 3500     |\n| CORD          | max_dose             | 30        | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 130      |\n| ESOPHAGUS     | max_dose             | 43        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 20        | NA       | NA       |\n| HEART         | quadratic            | NA        | NA       | 20       |\n| HEART         | max_dose             | 66        | NA       | NA       |\n| HEART         | mean_dose            | 25        | NA       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 30       |\n| LUNGS_NOT_GTV | max_dose             | 62        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 15        | NA       | NA       |\n| LUNG_L        | quadratic            | NA        | NA       | 15       |\n| LUNG_L        | max_dose             | 66        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 15       |\n| LUNG_R        | max_dose             | 66        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 20       |\n| RIND_0        | max_dose             | 62        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 15       |\n| RIND_1        | max_dose             | 61        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 15       |\n| RIND_2        | max_dose             | 52        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 10       |\n| RIND_3        | max_dose             | 50        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 5        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.19 |        64.53 | Meets Limit                                      |          2 |\n| max_dose     | PTV              |    69   |  64.64 |        64.53 | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        61.24 | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  15.45 |        13.17 | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   4.53 |         4.66 | Meets Limit                                      |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   8.59 |         9.17 | Meets Limit                                      |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  14.66 |        13.65 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   2.65 |        11    | Meets Limit                                      |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.37 |         1.69 | Meets Limit                                      |          5 |\n| max_dose     | RIND_0           |    66   |  62.84 |        63    | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  58.34 |        62    | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        52    | Meets Both Goal and Limit                        |          7 |\n| max_dose     | RIND_3           |    51   |  49.2  |        50    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.91 |         0.8  | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.09 |         0.03 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_30",
        'OptPara:\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|:--------------|:---------------------|:----------|:---------|:---------|\n| PTV           | quadratic-overdose   | 60        | NA       | 19000    |\n| PTV           | quadratic-underdose  | 62.5      | NA       | 590000   |\n| PTV           | max_dose             | 64        | NA       | NA       |\n| GTV           | max_dose             | 69        | NA       | NA       |\n| CORD          | linear-overdose      | 37        | NA       | 22000    |\n| CORD          | quadratic            | NA        | NA       | 350      |\n| CORD          | max_dose             | 37        | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 750      |\n| ESOPHAGUS     | max_dose             | 45        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 11        | NA       | NA       |\n| HEART         | quadratic            | NA        | NA       | 750      |\n| HEART         | max_dose             | 45        | NA       | NA       |\n| HEART         | mean_dose            | 9         | NA       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 250      |\n| LUNGS_NOT_GTV | max_dose             | 63        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 14        | NA       | 350      |\n| LUNG_L        | quadratic            | NA        | NA       | 90       |\n| LUNG_L        | max_dose             | 63        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 90       |\n| LUNG_R        | max_dose             | 63        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 2        |\n| RIND_0        | max_dose             | 64        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 2        |\n| RIND_1        | max_dose             | 61        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 2        |\n| RIND_2        | max_dose             | 52        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 2        |\n| RIND_3        | max_dose             | 49        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 2        |\n| RIND_4        | max_dose             | 43        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.53 |        64    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  65.43 |        64    | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60.95 | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  41.11 |        37    | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   9.34 |         8.34 | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |  14.27 |        13.48 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  44.6  |        38.42 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   4.56 |         4.65 | Meets Limit                                      |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0.04 | Meets Limit                                      |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |  51.91 |        45    | Meets Both Goal and Limit                        |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   4.06 |         3.68 | Meets Both Goal and Limit                        |          5 |\n| max_dose     | RIND_0           |    66   |  63.7  |        64    | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  58.36 |        61    | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        52    | Meets Both Goal and Limit                        |          7 |\n| max_dose     | RIND_3           |    51   |  42.03 |        49    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.89 |         0.8  | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.11 |         0.06 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_33",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy            | % Volume   | Weight   |\n|:--------------|:---------------------|:---------------------|:-----------|:---------|\n| PTV           | quadratic-overdose   | 60                   | NA         | 2000     |\n| PTV           | quadratic-underdose  | 60                   | NA         | 1000000  |\n| PTV           | linear-overdose      | 60                   | NA         | 4500     |\n| PTV           | dose_volume_V        | 60                   | 95         | NA       |\n| GTV           | max_dose             | 69                   | NA         | NA       |\n| CORD          | linear-overdose      | 45                   | NA         | 1000     |\n| CORD          | quadratic            | NA                   | NA         | 35       |\n| CORD          | max_dose             | 48                   | NA         | NA       |\n| ESOPHAGUS     | quadratic            | NA                   | NA         | 35       |\n| ESOPHAGUS     | max_dose             | 63                   | NA         | NA       |\n| ESOPHAGUS     | mean_dose            | 34                   | NA         | NA       |\n| ESOPHAGUS     | dose_volume_V        | 60                   | 20         | NA       |\n| HEART         | quadratic            | NA                   | NA         | 35       |\n| HEART         | max_dose             | 66                   | NA         | NA       |\n| HEART         | mean_dose            | 25                   | NA         | NA       |\n| HEART         | dose_volume_V        | 30                   | 50         | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA                   | NA         | 30       |\n| LUNGS_NOT_GTV | max_dose             | 66                   | NA         | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 16                   | NA         | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 20                   | 30         | NA       |\n| LUNG_L        | quadratic            | NA                   | NA         | 25       |\n| LUNG_L        | max_dose             | 66                   | NA         | NA       |\n| LUNG_R        | quadratic            | NA                   | NA         | 25       |\n| LUNG_R        | max_dose             | 66                   | NA         | NA       |\n| RIND_0        | quadratic            | NA                   | NA         | 50       |\n| RIND_0        | max_dose             | 1.1*prescription_gy  | NA         | NA       |\n| RIND_1        | quadratic            | NA                   | NA         | 50       |\n| RIND_1        | max_dose             | 1.05*prescription_gy | NA         | NA       |\n| RIND_2        | quadratic            | NA                   | NA         | 50       |\n| RIND_2        | max_dose             | 0.9*prescription_gy  | NA         | NA       |\n| RIND_3        | quadratic            | NA                   | NA         | 50       |\n| RIND_3        | max_dose             | 0.85*prescription_gy | NA         | NA       |\n| RIND_4        | quadratic            | NA                   | NA         | 50       |\n| RIND_4        | max_dose             | 0.75*prescription_gy | NA         | NA       |\n| SKIN          | max_dose             | 60                   | NA         | NA       |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.06 |        63.41 | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  64.78 |        65.07 | Meets Limit                                      |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |   6.85 |        17.47 | Meets Limit                                      |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   3.89 |         3.2  | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   6.63 |         5.98 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  15.22 |        12.2  | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   2.62 |        10.25 | Meets Limit                                      |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.26 |         1.11 | Meets Limit                                      |          5 |\n| max_dose     | RIND_0           |    66   |  62.59 |        66    | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  57.62 |        63    | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  45.35 |        51    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.9  |         0.83 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.1  |         0.05 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_34",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|---------------|----------------------|-----------|----------|----------|\n| PTV           | quadratic-overdose   | 59.5      | NA       | 15000    |\n| PTV           | quadratic-underdose  | 60.5      | NA       | 850000   |\n| PTV           | max_dose             | 64        | NA       | NA       |\n| GTV           | max_dose             | 69        | NA       | NA       |\n| CORD          | linear-overdose      | 45        | NA       | 3000     |\n| CORD          | quadratic            | NA        | NA       | 25       |\n| CORD          | max_dose             | 48        | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 120      |\n| ESOPHAGUS     | max_dose             | 28        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 7         | NA       | NA       |\n| ESOPHAGUS     | dose_volume_V        | 10        | 1.5      | NA       |\n| HEART         | quadratic            | NA        | NA       | 40       |\n| HEART         | max_dose             | 60        | NA       | NA       |\n| HEART         | mean_dose            | 25        | NA       | NA       |\n| HEART         | dose_volume_V        | 30        | 40       | NA       |\n| HEART         | dose_volume_V        | 20        | 10       | NA       |\n| HEART         | dose_volume_V        | 10        | 5        | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 10       |\n| LUNGS_NOT_GTV | max_dose             | 66        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 16        | NA       | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 20        | 30       | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 5         | 50       | NA       |\n| LUNG_L        | quadratic            | NA        | NA       | 10       |\n| LUNG_L        | max_dose             | 66        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 10       |\n| LUNG_R        | max_dose             | 66        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 5        |\n| RIND_0        | max_dose             | 66        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 5        |\n| RIND_1        | max_dose             | 63        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 3        |\n| RIND_2        | max_dose             | 54        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 3        |\n| RIND_3        | max_dose             | 51        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 3        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.07 |        64    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  65.06 |        64    | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60.4  | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  11.67 |         9.74 | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   4.64 |         3.93 | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   7.83 |         7.41 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  17.94 |        14.32 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0.09 |         0    | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   5.22 |        11.67 | Meets Limit                                      |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.58 |         1.08 | Meets Limit                                      |          5 |\n| max_dose     | RIND_0           |    66   |  63.54 |        66    | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  56.86 |        63    | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  44.21 |        51    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.88 |         0.81 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.11 |         0.05 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_36",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight  |\n|---------------|----------------------|-----------|----------|---------|\n| PTV           | quadratic-overdose   | 57.5      | NA       | 800     |\n| PTV           | quadratic-underdose  | 60        | NA       | 1950000 |\n| PTV           | max_dose             | 65.19     | NA       | NA      |\n| GTV           | max_dose             | 69        | NA       | NA      |\n| CORD          | linear-overdose      | 35        | NA       | 25000   |\n| CORD          | quadratic            | NA        | NA       | 250     |\n| CORD          | max_dose             | 33        | NA       | NA      |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 170     |\n| ESOPHAGUS     | max_dose             | 27        | NA       | NA      |\n| ESOPHAGUS     | mean_dose            | 17        | NA       | NA      |\n| HEART         | quadratic            | NA        | NA       | 50      |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 50      |\n| RIND_2        | quadratic            | NA        | NA       | 70      |\n| RIND_2        | max_dose             | 52        | NA       | NA      |\n| RIND_0        | quadratic            | NA        | NA       | 70      |\n| RIND_0        | max_dose             | 65.9      | NA       | NA      |\n| RIND_1        | quadratic            | NA        | NA       | 70      |\n| RIND_3        | quadratic            | NA        | NA       | 60      |\n| RIND_4        | quadratic            | NA        | NA       | 60      |\n| SKIN          | max_dose             | 60        | NA       | NA      |\n| NA            | smoothness-quadratic | NA        | NA       | 750     |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  63.98 |        64.6  | Meets Limit                                      |          2 |\n| max_dose     | PTV              |    69   |  65.19 |        65.19 | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        59.99 | Meets Limit                                      |          2 |\n| max_dose     | CORD             |    50   |   3.68 |         4.78 | Meets Limit                                      |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   3.83 |         3.11 | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   4.92 |         4.19 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  19.43 |        16.01 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0.34 |         0.29 | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   5.18 |         5.37 | Meets Limit                                      |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.23 |         0.35 | Meets Limit                                      |          5 |\n| max_dose     | RIND_0           |    66   |  63.67 |        65.19 | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  57.81 |        59.62 | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  49.12 |        52    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  35.63 |        36.96 | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.88 |         0.85 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.12 |         0.07 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_37",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|---------------|----------------------|-----------|----------|----------|\n| PTV           | quadratic-overdose   | 60        | NA       | 13000    |\n| PTV           | quadratic-underdose  | 60        | NA       | 640000   |\n| PTV           | quadratic-underdose  | 60.5      | NA       | 370000   |\n| PTV           | max_dose             | 67        | NA       | NA       |\n| CORD          | linear-overdose      | 17        | NA       | 70000    |\n| CORD          | quadratic-overdose   | 17        | NA       | 50000    |\n| CORD          | max_dose             | 8.5       | NA       | NA       |\n| CORD          | dose_volume_V        | 8         | 1        | NA       |\n| ESOPHAGUS     | quadratic-overdose   | 6         | NA       | 24000    |\n| ESOPHAGUS     | max_dose             | 12        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 7         | NA       | NA       |\n| ESOPHAGUS     | dose_volume_V        | 8         | 10       | NA       |\n| HEART         | quadratic            | NA        | NA       | 20       |\n| HEART         | max_dose             | 60        | NA       | NA       |\n| HEART         | mean_dose            | 25        | NA       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 20       |\n| LUNGS_NOT_GTV | max_dose             | 63        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 16        | NA       | NA       |\n| LUNG_L        | quadratic            | NA        | NA       | 10       |\n| LUNG_L        | max_dose             | 63        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 10       |\n| LUNG_R        | max_dose             | 63        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 12       |\n| RIND_0        | max_dose             | 66        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 12       |\n| RIND_1        | max_dose             | 63        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 7        |\n| RIND_2        | max_dose             | 54        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 7        |\n| RIND_3        | max_dose             | 51        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 7        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |\n| NA            | smoothness-quadratic | NA        | NA       | 2300     |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  63.87 |        63    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  64.74 |        63    | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |   8.82 |         8.5  | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   5.18 |         4.3  | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   8.84 |         7.58 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  19.95 |        15.29 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   7.07 |         6.71 | Meets Both Goal and Limit                        |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.37 |         0.35 | Meets Both Goal and Limit                        |          5 |\n| max_dose     | RIND_0           |    66   |  63.59 |        63.31 | Meets Both Goal and Limit                        |          7 |\n| max_dose     | RIND_1           |    63   |  56.83 |        61.63 | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  51.98 |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  42.5  |        51    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.88 |         0.84 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.11 |         0.04 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_42",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|---------------|----------------------|-----------|----------|----------|\n| PTV           | quadratic-overdose   | 60        | NA       | 200      |\n| PTV           | quadratic-underdose  | 60        | NA       | 3500000  |\n| PTV           | quadratic            | 60        | NA       | 1200     |\n| PTV           | max_dose             | 69        | NA       | NA       |\n| PTV           | dose_volume_V        | 62        | 97       | NA       |\n| PTV           | dose_volume_V        | 60        | 99       | NA       |\n| PTV           | dose_volume_V        | 60        | 98       | NA       |\n| GTV           | max_dose             | 69        | NA       | NA       |\n| CORD          | linear-overdose      | 6         | NA       | 1200     |\n| CORD          | quadratic            | NA        | NA       | 8        |\n| CORD          | max_dose             | 6         | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 20       |\n| ESOPHAGUS     | max_dose             | 5         | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 34        | NA       | NA       |\n| HEART         | quadratic            | NA        | NA       | 14       |\n| HEART         | max_dose             | 63        | NA       | NA       |\n| HEART         | dose_volume_V        | 20        | 50       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 4        |\n| LUNGS_NOT_GTV | max_dose             | 66        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 16        | NA       | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 20        | 32       | NA       |\n| LUNG_L        | quadratic            | NA        | NA       | 4        |\n| LUNG_L        | max_dose             | 66        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 4        |\n| LUNG_R        | max_dose             | 66        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 3        |\n| RIND_0        | max_dose             | 66        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 3        |\n| RIND_1        | max_dose             | 63        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 2        |\n| RIND_2        | max_dose             | 54        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 2        |\n| RIND_3        | max_dose             | 51        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 2        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |\n| NA            | smoothness-quadratic | NA        | NA       | 6000     |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.18 |        64.47 | Meets Limit                                      |          2 |\n| max_dose     | PTV              |    69   |  65.63 |        66    | Meets Limit                                      |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |   6.81 |         6    | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   4.24 |         3.6  | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   5.19 |         5.51 | Meets Limit                                      |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  21.15 |        17.77 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0.07 |         0    | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   5.3  |         5    | Meets Both Goal and Limit                        |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.56 |         0.55 | Meets Both Goal and Limit                        |          5 |\n| max_dose     | RIND_0           |    66   |  62.71 |        66    | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  55.61 |        61.61 | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  48.03 |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  31.49 |        42.33 | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.91 |         0.83 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.1  |         0.09 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_44",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy            | % Volume   | Weight   |\n|:--------------|:---------------------|:---------------------|:-----------|:---------|\n| PTV           | quadratic-overdose   | 59                   | NA         | 7500     |\n| PTV           | quadratic-underdose  | 63                   | NA         | 285000   |\n| PTV           | max_dose             | 64                   | NA         | NA       |\n| PTV           | quadratic            | NA                   | NA         | 5200     |\n| PTV           | linear-overdose      | 61                   | NA         | 3200     |\n| GTV           | max_dose             | 68                   | NA         | NA       |\n| CORD          | linear-overdose      | 45                   | NA         | 4500     |\n| CORD          | quadratic            | NA                   | NA         | 400      |\n| CORD          | max_dose             | 41                   | NA         | NA       |\n| ESOPHAGUS     | quadratic-overdose   | 7.5                  | NA         | 8500     |\n| ESOPHAGUS     | quadratic            | NA                   | NA         | 6000     |\n| ESOPHAGUS     | max_dose             | 7.5                  | NA         | NA       |\n| ESOPHAGUS     | mean_dose            | 7.0                  | NA         | NA       |\n| HEART         | quadratic            | NA                   | NA         | 800      |\n| HEART         | max_dose             | 57                   | NA         | NA       |\n| HEART         | mean_dose            | 9.0                  | NA         | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA                   | NA         | 450      |\n| LUNGS_NOT_GTV | max_dose             | 64                   | NA         | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 11.0                 | NA         | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 18                   | 16.5       | NA       |\n| LUNG_L        | quadratic            | NA                   | NA         | 60       |\n| LUNG_L        | max_dose             | 65                   | NA         | NA       |\n| LUNG_R        | quadratic            | NA                   | NA         | 60       |\n| LUNG_R        | max_dose             | 65                   | NA         | NA       |\n| RIND_0        | quadratic            | NA                   | NA         | 40       |\n| RIND_0        | max_dose             | 66                   | NA         | NA       |\n| RIND_1        | quadratic            | NA                   | NA         | 40       |\n| RIND_1        | max_dose             | 62                   | NA         | NA       |\n| RIND_2        | quadratic            | NA                   | NA         | 40       |\n| RIND_2        | max_dose             | 54                   | NA         | NA       |\n| RIND_3        | quadratic            | NA                   | NA         | 40       |\n| RIND_3        | max_dose             | 51                   | NA         | NA       |\n| RIND_4        | quadratic            | NA                   | NA         | 40       |\n| RIND_4        | max_dose             | 45                   | NA         | NA       |\n| SKIN          | max_dose             | 60                   | NA         | NA       |\n| NA            | smoothness-quadratic | NA                   | NA         | 300      |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                             |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-----------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.49 |        64    | Meets Both Goal and Limit          |          2 |\n| max_dose     | PTV              |    69   |  64.6  |        64    | Meets Both Goal and Limit          |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60.34 | Meets Both Goal and Limit          |          2 |\n| max_dose     | CORD             |    50   |  42.01 |        41    | Meets Both Goal and Limit          |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   6.56 |         5.32 | Meets Both Goal and Limit          |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   9.64 |         9.26 | Meets Both Goal and Limit          |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  25.99 |        21.08 | Meets Both Goal and Limit          |          4 |\n| mean_dose    | HEART            |    25   |   4.91 |         3.51 | Meets Both Goal and Limit          |          5 |\n| V(30.0Gy)    | HEART            |    40   |   1.36 |         1.38 | Meets Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0.04 | Meets Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |  11.73 |         7.21 | Meets Both Goal and Limit          |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   2.09 |         0.13 | Meets Both Goal and Limit          |          5 |\n| max_dose     | RIND_0           |    66   |  63.73 |        65.79 | Meets Limit                        |          7 |\n| max_dose     | RIND_1           |    63   |  60.6  |        62    | Meets Limit                        |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        54    | Meets Limit                        |          7 |\n| max_dose     | RIND_3           |    51   |  45.94 |        51    | Meets Limit                        |          7 |\n| CI           | nan              |     0.7 |   0.87 |         0.79 | Closer to 1 is better. Meets Limit |          6 |\n| HI           | nan              |     0.2 |   0.1  |         0.11 | Closer to 0 is better. Meets Limit |          6 |'
        )
        self.add_best_iteration("Lung_Patient_45",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|---------------|----------------------|-----------|----------|----------|\n| PTV           | quadratic-overdose   | 62        | NA       | 14000    |\n| PTV           | quadratic-underdose  | 60        | NA       | 350000   |\n| PTV           | max_dose             | 66        | NA       | NA       |\n| GTV           | max_dose             | 69        | NA       | NA       |\n| CORD          | linear-overdose      | 45        | NA       | 1500     |\n| CORD          | quadratic            | NA        | NA       | 15       |\n| CORD          | max_dose             | 48        | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 35       |\n| ESOPHAGUS     | max_dose             | 66        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 34        | NA       | NA       |\n| HEART         | quadratic            | NA        | NA       | 35       |\n| HEART         | max_dose             | 66        | NA       | NA       |\n| HEART         | mean_dose            | 25        | NA       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 35       |\n| LUNGS_NOT_GTV | mean_dose            | 16        | NA       | NA       |\n| LUNG_L        | quadratic            | NA        | NA       | 20       |\n| LUNG_L        | max_dose             | 66        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 20       |\n| LUNG_R        | max_dose             | 66        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 15       |\n| RIND_0        | max_dose             | 63        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 15       |\n| RIND_1        | max_dose             | 60        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 10       |\n| RIND_2        | max_dose             | 54        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 10       |\n| RIND_3        | max_dose             | 51        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 5        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.02 |        62    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  65.05 |        65    | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  12.72 |        10.61 | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   5.73 |         5.09 | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   9.96 |         9.42 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  24.32 |        19.74 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0.47 |         0.09 | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   8.27 |         4.27 | Meets Both Goal and Limit                        |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.39 |         0.01 | Meets Both Goal and Limit                        |          5 |\n| max_dose     | RIND_0           |    66   |  63.73 |        63    | Meets Both Goal and Limit                        |          7 |\n| max_dose     | RIND_1           |    63   |  57.7  |        59.8  | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  46.12 |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  39.12 |        51    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.87 |         0.86 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.11 |         0.04 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_46",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|:--------------|:---------------------|:----------|:---------|:---------|\n| PTV           | quadratic-underdose  | 60        | NA       | 2750000  |\n| PTV           | quadratic-overdose   | 64.0      | NA       | 500      |\n| PTV           | max_dose             | 64.68     | NA       | NA       |\n| GTV           | quadratic-overdose   | 61.5      | NA       | 5000     |\n| GTV           | max_dose             | 61.5      | NA       | NA       |\n| CORD          | linear-overdose      | 45        | NA       | 7000     |\n| CORD          | quadratic            | NA        | NA       | 50       |\n| CORD          | max_dose             | 47        | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 50       |\n| ESOPHAGUS     | max_dose             | 63        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 34        | NA       | NA       |\n| HEART         | quadratic            | NA        | NA       | 50       |\n| HEART         | max_dose             | 63        | NA       | NA       |\n| HEART         | mean_dose            | 25        | NA       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 160      |\n| LUNGS_NOT_GTV | max_dose             | 66        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 13.5      | NA       | NA       |\n| LUNGS_NOT_GTV | dose_volume_V        | 20        | 33       | NA       |\n| LUNG_L        | quadratic            | NA        | NA       | 30       |\n| LUNG_L        | max_dose             | 66        | NA       | NA       |\n| LUNG_R        | quadratic            | NA        | NA       | 30       |\n| LUNG_R        | max_dose             | 66        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 5        |\n| RIND_0        | max_dose             | 66        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 5        |\n| RIND_1        | max_dose             | 63        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 3        |\n| RIND_2        | max_dose             | 54        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 3        |\n| RIND_3        | max_dose             | 51        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 3        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |\n| NA            | smoothness-quadratic | NA        | NA       | 100      |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  63.23 |        61.5  | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  64.68 |        64.68 | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60.04 | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  10.19 |         5.43 | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   2.92 |         2.21 | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   3.26 |         3.06 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  15.13 |         9.92 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0.1  |         0.05 | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   1.05 |         0.29 | Meets Both Goal and Limit                        |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.16 |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | RIND_0           |    66   |  63.34 |        64.68 | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  57.77 |        61.24 | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  48.16 |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  35.71 |        51    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.89 |         0.84 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.1  |         0.07 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
        self.add_best_iteration("Lung_Patient_48",
        'OptPara\n| ROI Name      | Objective Type       | Target Gy | % Volume | Weight   |\n|---------------|----------------------|-----------|----------|----------|\n| PTV           | quadratic-overdose   | 60        | NA       | 14000    |\n| PTV           | quadratic-underdose  | 60        | NA       | 950000   |\n| PTV           | max_dose             | 69        | NA       | NA       |\n| PTV           | dose_volume_V        | 60        | 95       | NA       |\n| PTV           | dose_volume_V        | 60        | 98       | NA       |\n| GTV           | max_dose             | 69        | NA       | NA       |\n| CORD          | linear-overdose      | 45        | NA       | 3500     |\n| CORD          | quadratic            | NA        | NA       | 100      |\n| CORD          | max_dose             | 48        | NA       | NA       |\n| ESOPHAGUS     | quadratic            | NA        | NA       | 200      |\n| ESOPHAGUS     | max_dose             | 63        | NA       | NA       |\n| ESOPHAGUS     | mean_dose            | 34        | NA       | NA       |\n| HEART         | quadratic            | NA        | NA       | 60       |\n| HEART         | max_dose             | 63        | NA       | NA       |\n| HEART         | mean_dose            | 25        | NA       | NA       |\n| LUNGS_NOT_GTV | quadratic            | NA        | NA       | 60       |\n| LUNGS_NOT_GTV | max_dose             | 63        | NA       | NA       |\n| LUNGS_NOT_GTV | mean_dose            | 16        | NA       | NA       |\n| RIND_0        | quadratic            | NA        | NA       | 5        |\n| RIND_0        | max_dose             | 66        | NA       | NA       |\n| RIND_1        | quadratic            | NA        | NA       | 5        |\n| RIND_1        | max_dose             | 63        | NA       | NA       |\n| RIND_2        | quadratic            | NA        | NA       | 4        |\n| RIND_2        | max_dose             | 54        | NA       | NA       |\n| RIND_3        | quadratic            | NA        | NA       | 4        |\n| RIND_3        | max_dose             | 51        | NA       | NA       |\n| RIND_4        | quadratic            | NA        | NA       | 4        |\n| RIND_4        | max_dose             | 45        | NA       | NA       |\n| SKIN          | max_dose             | 60        | NA       | NA       |\n| NA            | smoothness-quadratic | NA        | NA       | 600      |',
        'Dose outcomes:\n| constraint   | structure_name   |   Limit |   Goal |   Plan Value | Status                                           |   Priority |\n|:-------------|:-----------------|--------:|-------:|-------------:|:-------------------------------------------------|-----------:|\n| max_dose     | GTV              |    69   |  64.23 |        62.59 | Meets Both Goal and Limit                        |          2 |\n| max_dose     | PTV              |    69   |  64.71 |        64.36 | Meets Both Goal and Limit                        |          2 |\n| D(95.0%)     | PTV              |    57   |  60    |        60    | Meets Both Goal and Limit                        |          2 |\n| max_dose     | CORD             |    50   |  12.53 |         9.33 | Meets Both Goal and Limit                        |          1 |\n| mean_dose    | LUNGS_NOT_GTV    |    16   |   5.31 |         4.66 | Meets Both Goal and Limit                        |          4 |\n| V(20.0Gy)    | LUNGS_NOT_GTV    |    30   |   8.69 |         8.35 | Meets Both Goal and Limit                        |          3 |\n| V(5.0Gy)     | LUNGS_NOT_GTV    |    60   |  20.82 |        18.63 | Meets Both Goal and Limit                        |          4 |\n| mean_dose    | HEART            |    25   |   0.64 |         0.47 | Meets Both Goal and Limit                        |          5 |\n| V(30.0Gy)    | HEART            |    40   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| V(40.0Gy)    | HEART            |    30   |   0    |         0    | Meets Both Goal and Limit                        |          5 |\n| max_dose     | ESOPHAGUS        |    63   |   4.44 |         4.56 | Meets Limit                                      |          5 |\n| mean_dose    | ESOPHAGUS        |    34   |   0.63 |         0.29 | Meets Both Goal and Limit                        |          5 |\n| max_dose     | RIND_0           |    66   |  63.29 |        64.36 | Meets Limit                                      |          7 |\n| max_dose     | RIND_1           |    63   |  58.29 |        62.01 | Meets Limit                                      |          7 |\n| max_dose     | RIND_2           |    54   |  52.2  |        54    | Meets Limit                                      |          7 |\n| max_dose     | RIND_3           |    51   |  44.58 |        51    | Meets Limit                                      |          7 |\n| CI           | nan              |     0.7 |   0.88 |         0.83 | Closer to 1 is better. Meets Limit               |          6 |\n| HI           | nan              |     0.2 |   0.1  |         0.03 | Closer to 0 is better. Meets Both Limit and Goal |          6 |'
        )
       
    def create_tables(self):
        self.cursor.execute('''CREATE TABLE IF NOT EXISTS patient_volumes
                          (name TEXT PRIMARY KEY, 
                           ptv REAL,
                           esophagus REAL,
                           heart REAL,
                           lung_l REAL,
                           lung_r REAL,
                           cord REAL)''')
    
        self.cursor.execute('''CREATE TABLE IF NOT EXISTS distance_to_ptv
                          (name TEXT PRIMARY KEY,
                           esophagus_ptv_distance REAL,
                           heart_ptv_distance REAL,
                           lung_l_ptv_distance REAL,
                           lung_r_ptv_distance REAL,
                           cord_ptv_distance REAL)''')

        self.cursor.execute('''CREATE TABLE IF NOT EXISTS best_iteration
                        (name TEXT PRIMARY KEY,
                        opt_para TEXT,
                        dose_outcomes TEXT)''')

        self.conn.commit()

    def add_patient(self, name, ptv, esophagus, heart, lung_l, lung_r, cord, esophagus_ptv_distance, heart_ptv_distance, lung_l_ptv_distance, lung_r_ptv_distance, cord_ptv_distance):
        patient_volumes = (name, ptv, esophagus, heart, lung_l, lung_r, cord)
        distances_to_ptv = (name, esophagus_ptv_distance, heart_ptv_distance, lung_l_ptv_distance, lung_r_ptv_distance, cord_ptv_distance)
        
        self.cursor.execute("INSERT OR REPLACE INTO patient_volumes VALUES (?, ?, ?, ?, ?, ?, ?)", patient_volumes)
        self.cursor.execute("INSERT OR REPLACE INTO distance_to_ptv VALUES (?, ?, ?, ?, ?, ?)", distances_to_ptv)
        self.conn.commit()
    
    def add_best_iteration(self, name, opt_para, dose_outcomes):
        best_iter_data = (name, opt_para, dose_outcomes)
        self.cursor.execute("INSERT OR REPLACE INTO best_iteration VALUES (?, ?, ?)", best_iter_data)
        self.conn.commit()

    def get_patient(self, name):
        self.cursor.execute("SELECT * FROM patient_volumes WHERE name = ?", (name,))
        volumes = self.cursor.fetchone()
        self.cursor.execute("SELECT * FROM distance_to_ptv WHERE name = ?", (name,))
        distances = self.cursor.fetchone()
        return volumes, distances

    def get_best_iteration(self, name):
        self.cursor.execute("SELECT * FROM best_iteration WHERE name = ?", (name,))
        return self.cursor.fetchall()

    def get_all_patient_names(self):
        self.cursor.execute("SELECT DISTINCT name FROM patient_volumes")
        return [row[0] for row in self.cursor.fetchall()] 

    def close(self):
        self.conn.close()

    @staticmethod    
    def unit_test():
        pd.set_option('display.max_rows', None)
        pd.set_option('display.max_columns', None)
        pd.set_option('display.width', None)
        pd.set_option('display.max_colwidth', None)

        db = LungCancerDB()
        print(db.get_patient('Lung_Patient_18'))
        db.close()

if __name__ == '__main__':
    LungCancerDB.unit_test()
